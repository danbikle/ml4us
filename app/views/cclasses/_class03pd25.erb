<code class='sql'>

ann=# 
ann=# INSERT INTO prices3
ann-# SELECT cdate,openp,closep, closep - openp AS diff FROM prices
ann-# WHERE cdate = '2016-08-01';
INSERT 0 1
ann=# 
ann=# INSERT INTO prices3
ann-# SELECT cdate,openp,closep, closep - openp AS diff FROM prices
ann-# WHERE  cdate BETWEEN '2016-08-01' AND '2016-08-31'
ann-# AND    cdate NOT IN (SELECT cdate FROM prices3);
INSERT 0 5
ann=# 
ann=# UPDATE prices3 SET diff = 0;
UPDATE 221
ann=#
ann=# -- The above NOT IN helps me prevent insert of duplicates:


ann=# SELECT * FROM prices3 WHERE cdate BETWEEN '2016-08-01' AND '2016-09-01' ORDER BY cdate;
   cdate    |   openp    |   closep   | diff 
------------+------------+------------+------
 2016-08-01 | 155.089142 | 161.449997 |    0
 2016-08-02 | 155.687683 | 160.580002 |    0
 2016-08-03 | 154.587158 | 160.669998 |    0
 2016-08-04 | 155.291885 | 161.550003 |    0
 2016-08-05 | 156.392410 | 163.500000 |    0
 2016-08-08 | 158.453949 | 162.039993 |    0
 2016-08-09 | 157.957336 | 161.770004 |    0
 2016-08-10 | 157.928146 | 162.080002 |    0
 2016-08-11 | 157.986557 | 163.529999 |    0
 2016-08-12 | 158.901871 | 161.949997 |    0
 2016-08-15 | 158.132614 | 161.880005 |    0
 2016-08-16 | 156.876511 | 160.699997 |    0
 2016-08-17 | 156.740189 | 160.440002 |    0
 2016-08-18 | 156.662292 | 161.360001 |    0
 2016-08-19 | 156.613617 | 160.039993 |    0
 2016-08-22 | 155.795685 | 160.000000 |    0
 2016-08-23 | 156.117004 | 160.259995 |    0
 2016-08-24 | 155.688583 | 159.050003 |    0
 2016-08-25 | 154.821960 | 158.630005 |    0
 2016-08-26 | 154.705109 | 158.320007 |    0
 2016-08-29 | 154.656433 | 159.720001 |    0
 2016-08-30 | 155.561996 | 159.399994 |    0
 2016-08-31 | 155.464615 | 158.880005 |    0
 2016-09-01 | 154.159836 | 159.539993 |    0
(24 rows)

ann=# 
</code>
